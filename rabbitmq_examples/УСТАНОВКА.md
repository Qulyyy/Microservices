# Установка и запуск примеров RabbitMQ

## Установка зависимостей

### Вариант 1: Установка через pip

```powershell
# Из корневой директории проекта
cd rabbitmq_examples
python -m pip install -r requirements.txt
```

Или напрямую:
```powershell
python -m pip install pika==1.3.2
```

### Вариант 2: Если используется виртуальное окружение

```powershell
# Создание виртуального окружения
python -m venv venv

# Активация (Windows PowerShell)
.\venv\Scripts\Activate.ps1

# Если возникает ошибка выполнения скриптов:
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

# Установка зависимостей
pip install -r requirements.txt
```

## Проверка установки

```powershell
python -c "import pika; print('pika установлен:', pika.__version__)"
```

Должно вывести: `pika установлен: 1.3.2`

## Запуск RabbitMQ

### Через Docker Compose (рекомендуется)

```powershell
# Из корневой директории проекта
docker-compose up -d rabbitmq
```

### Проверка работы RabbitMQ

Откройте в браузере: http://localhost:15672
- Логин: `guest`
- Пароль: `guest`

## Запуск примеров

### Задание 1: Простейшее взаимодействие

**Эксклюзивная очередь:**
```powershell
# Терминал 1 - Consumer (запустите первым!)
cd rabbitmq_examples/task1_exclusive_queue
python consumer.py

# Терминал 2 - Producer
cd rabbitmq_examples/task1_exclusive_queue
python producer.py "Тестовое сообщение"
```

**Устойчивая очередь:**
```powershell
# Терминал 1
cd rabbitmq_examples/task1_durable_queue
python consumer.py

# Терминал 2
python producer.py "Сообщение"
```

**Автоудаляемая очередь:**
```powershell
# Терминал 1
cd rabbitmq_examples/task1_autodelete_queue
python consumer.py

# Терминал 2
python producer.py "Сообщение"
```

### Задание 2: Взаимодействие с нагрузкой

**Fanout (символ #):**
```powershell
# Терминал 1
cd rabbitmq_examples/task2_fanout
python consumer.py 2

# Терминал 2
python producer.py "Сообщение для всех" 1
```
**Примечание:** В PowerShell символ `#` является комментарием, поэтому используйте число без символа.

**Direct (символ *):**
```powershell
# Терминал 1
cd rabbitmq_examples/task2_direct
python consumer.py info 1

# Терминал 2
python producer.py "Сообщение для info" info 1
```
**Примечание:** В PowerShell используйте число без символа `*`.

**Topic (символ -):**
```powershell
# Терминал 1
cd rabbitmq_examples/task2_topic
python consumer.py "stock.*.usd" 1

# Терминал 2
python producer.py "Акции США" stock.usa.usd 1
```
**Примечание:** В PowerShell используйте число без символа `-`.

## Решение проблем

### Ошибка: "ModuleNotFoundError: No module named 'pika'"

**Решение:**
```powershell
python -m pip install pika==1.3.2
```

Если не помогает, попробуйте:
```powershell
python -m pip install --user pika==1.3.2
```

### Ошибка: "Connection refused"

**Решение:** Убедитесь, что RabbitMQ запущен:
```powershell
docker-compose ps rabbitmq
```

Если не запущен:
```powershell
docker-compose up -d rabbitmq
```

### Ошибка: "RESOURCE_LOCKED" для эксклюзивной очереди

**Решение:** Для эксклюзивной очереди consumer должен быть запущен ПЕРВЫМ!

1. Сначала запустите consumer
2. Затем запустите producer

### Проверка версии Python

```powershell
python --version
```

Рекомендуется Python 3.11 или выше.

## Использование учебного сервера

Если хотите использовать учебный сервер вместо локального, измените параметры в файлах:

```python
RABBITMQ_HOST = '51.250.26.59'
RABBITMQ_PORT = 5672
RABBITMQ_USER = 'guest'
RABBITMQ_PASSWORD = 'guest123'
```

Или создайте файл `.env` и используйте переменные окружения.

