# Включение публичного доступа к Serverless Container

## Проблема

При попытке доступа к контейнеру возникает ошибка:
```json
{
  "errorCode": 403,
  "errorMessage": "Forbidden: Not authorized",
  "errorType": "ClientError"
}
```

## Причина

Публичный доступ к контейнеру не включен в настройках Яндекс.Облака.

## Решение

### Способ 1: Через веб-интерфейс Яндекс.Облака

1. Откройте https://console.cloud.yandex.ru
2. Перейдите в **Serverless Containers**
3. Найдите ваш контейнер (например, `laptev-user-service`)
4. Нажмите на контейнер, чтобы открыть его настройки
5. Перейдите на вкладку **Обзор** или **Настройки**
6. Найдите раздел **Публичный доступ** или **Public access**
7. Включите переключатель **Публичный доступ**
8. Сохраните изменения

### Способ 2: Через YC CLI

```bash
# Включить публичный доступ
yc serverless container allow-unauthenticated-invoke \
  --name ваш-контейнер \
  --folder-id ваш-folder-id
```

### Способ 3: При создании новой ревизии

В CI/CD workflow можно добавить параметр `--allow-unauthenticated-invoke`:

```yaml
yc serverless container revision deploy \
  --container-name ${{ secrets.YC_CONTAINER_NAME }} \
  --image cr.yandex/${{ secrets.YC_REGISTRY_ID }}/user-service:latest \
  --service-account-id "$SA_ID" \
  --cores 1 \
  --memory 128MB \
  --execution-timeout 30s \
  --concurrency 10 \
  --environment AUTH_SERVICE_URL=${{ secrets.AUTH_SERVICE_URL || 'http://auth-service:5001' }} \
  --folder-id ${{ secrets.YC_FOLDER_ID }} \
  --allow-unauthenticated-invoke
```

## Проверка

После включения публичного доступа:

1. Скопируйте URL контейнера из Яндекс.Облака
2. Откройте в браузере:
   ```
   https://ваш-url-контейнера/health
   ```

3. Ожидаемый ответ:
   ```json
   {
     "status": "ok",
     "service": "user_service"
   }
   ```

## Безопасность

⚠️ **Важно:** Публичный доступ позволяет любому пользователю вызывать ваш контейнер без авторизации.

Если нужна защита:
- Используйте авторизацию на уровне приложения (JWT токены)
- Или отключите публичный доступ и используйте авторизацию Яндекс.Облака

## Альтернатива: Авторизация через Яндекс.Облако

Если не хотите включать публичный доступ, можно использовать авторизацию:

1. Создайте сервисный аккаунт с ролью `serverless.functions.invoker`
2. Используйте IAM токен для вызова контейнера

Но для демонстрации и тестирования проще включить публичный доступ.

